<?php
    // Set up page title:
	$this->headTitle($this->translate('Availability Plus Test Cases'));

	//Load Cases
    $specsReader = new \VuFind\Config\SearchSpecsReader();
    $cases = $specsReader->get('availabilityplus-testcases.yaml');

    // Variables:
    $list = 1;
    if(isset($_GET["list"]) && $_GET["list"] === '0') $list = 0;

?>
<div class="AvailabilityPlusTestCases">
<? if(!empty($cases)) { ?>
    Links To TestCase Views: <a href="/vufind/AvailabilityPlus/TestCases?list=1">TestCases ResultsList</a> | <a href="/vufind/AvailabilityPlus/TestCases?list=0">TestCases DetailView</a>
	<table>
		<tr>
			<th>PPN</th>
			<th>Driver</th>
			<th>Description</th>
			<th>Expected</th>
			<th>Result</th>
			<th>Links</th>
			<th>Info</th>
		</tr>
		<? foreach ($cases AS $key => $case) { ?>
		    <?
				$id = $key;
				$driver = $case['driver'];
				$description = $case['description'];
				$expected = $case['expected'];
				$reason = $case['reason'];
				$date = $case['date'];
				$creator = $case['creator'];
				$detailsLink = $case['detailsLink'];
				$rules = $case['rules'];

                if($driver == 'Search2') {
                    $recordRoute = 'Search2Record';
                    $searchRoute = 'Search2';
                } else {
                    $recordRoute = 'Record';
                    $searchRoute = 'Search';
                }
			?>
			<tr>
                <td><a href="/vufind/<?=$recordRoute?>/<?=$id?>" target="_blank"><?=$id?></a></td>
				<td><?=$driver?></td>
				<td><?=$description?></td>
				<td><?=$expected?></td>
				<td>
					<div class="AvailabilityPlusTestCases">
					<?=$this->render('availabilityplus/item.phtml', ['id' => $id, 'driver' => $driver, 'list' => $list, 'mediatype' => $mediatype]) ?>
					</div>
				</td>
                <td>
                    <a href="/vufind/<?=$searchRoute?>/Results?lookfor=id:<?=$id?>" target="_blank">Ergebnislisten-Ansicht</a><br>
                    <a href="/vufind/<?=$recordRoute?>/<?=$id?>" target="_blank">Detail-Ansicht</a><br>
                    <a href="/vufind/AvailabilityPlus/Debug/<?=$id?>?list=<?=$list?>&driver=<?=$driver?>" target="_blank">Debug-Ansicht</a><br>
                </td>
                <td>
                    <? if(!empty($reason)) { ?>
                        Grund: <?=$reason?><br>
                    <? } ?>
                    <? if(!empty($creator)) { ?>
                        Erstellt durch: <?=$creator?><br>
                    <? } ?>
                    <? if(!empty($date)) { ?>
                        Erstellt am: <?=$date?><br>
                    <? } ?>
                    <? if(!empty($detailsLink)) { ?>
                        <a href="<?=$detailsLink?>" target="_blank">Link zu weiteren Details</a><br>
                    <? } ?>
                    <? if(!empty($rules)) { ?>
                        Gepr√ºfte Regel(n): <?=$rules?><br>
                    <? } ?>
                </td>
            </tr>
			</tr>
		<? } ?>
	</table>
<? } else { ?>
        <div>Keine TestCases definiert</div>
<? } ?>
</div>

